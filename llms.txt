# rw

The purpose of the rw package is to compute Robins-Wang variance
estimates for multiply imputed data analyses.

## Installation

This package requires the development version of mice with the `tasks`
argument:

``` r
remotes::install_github("amices/mice")
```

Then you can install the development version of rw like so:

``` r
remotes::install_github("LucyMcGowan/rw")
```

## Example

The first step is to impute your data using mice. Note that currently
only `method = "norm"` and `method = "logreg"` are supported. When using
the `mice` function, you must set the parameter `task = "train"` in
order to pass the necessary parts to our subsequent functions. For
example, see below. We will use the `nhanes` data from the mice package
and perform multiple imputation using the `norm` method.

``` r
library(rw)
library(mice)
set.seed(1)
nhanes_scaled <- as.data.frame(scale(nhanes))

imp <- mice(nhanes_scaled, 
            method = "norm",
            m = 5, 
            tasks = "train",
            print = FALSE)
```

Now, suppose we want to fit a model predicting `bmi` from `age` and
`hyp`. The `with_rw` function allows this, where the first argument is
the imputation object from the `mice` function above and the second is
the model expression. Note that currently outcome models must be
Gaussian or Binomial.

``` r
fit <- with_rw(imp, lm(bmi ~ age + hyp))
```

Finally, we can pool the results from the fit object and calculate the
Robins-Wang variance using the `pool_rw` function

``` r
pool_rw(fit)
#> 
#> ── Robins-Wang Pooled Results ──────────────────────────────────────────────────
#> Number of imputations: 5
#> Sample size: 25
#> 
#>                    term estimate std.error statistic p.value conf.low conf.high
#> (Intercept) (Intercept) -0.04751    0.3774   -0.1259  0.9010  -0.8302    0.7352
#> age                 age -0.45865    0.6034   -0.7601  0.4552  -1.7100    0.7927
#> hyp                 hyp  0.17550    1.6921    0.1037  0.9183  -3.3337    3.6847
```

Let’s compare this result to using Rubin’s rules.

``` r
fit_rr <- with(imp, lm(bmi ~ age + hyp))
pool(fit_rr) |>
  summary()
#>          term    estimate std.error  statistic        df   p.value
#> 1 (Intercept) -0.04751093 0.2077719 -0.2286686 15.029658 0.8222087
#> 2         age -0.45864607 0.3618038 -1.2676651  4.179919 0.2709358
#> 3         hyp  0.17549617 0.3683495  0.4764393  3.619564 0.6610792
```

## Giganti & Shepherd Example

Below is an example to replicate the Giganti & Shepherd (2020) results.

``` r
set.seed(1)
meth <- make.method(giganti_data)
meth[] <- ""
meth[c("A", "D")] <- c("norm", "logreg")

pred <- make.predictorMatrix(giganti_data)
pred[,] <- 0
pred["A", c("X1", "X2", "A.star", "D.star")] <- 1
pred["D", c("X1", "X2", "A.star", "D.star", "A")] <- 1

imp <- mice(giganti_data, m = 10, method = meth, predictorMatrix = pred,
            print = FALSE, tasks = "train")

fit_rw <- with_rw(imp, glm(D ~ A, subset = A > 2, family = binomial()))

pooled <- pool_rw(fit_rw)
pooled
#> 
#> ── Robins-Wang Pooled Results ──────────────────────────────────────────────────
#> Number of imputations: 10
#> Sample size: 4000
#> 
#>                    term estimate std.error statistic   p.value conf.low
#> (Intercept) (Intercept)  -3.4864   0.23876    -14.60 2.721e-48  -3.9543
#> A                     A   0.8764   0.08217     10.67 1.469e-26   0.7154
#>             conf.high
#> (Intercept)    -3.018
#> A               1.038
```

# Package index

## All functions

- [`giganti_data`](https://lucymcgowan.github.io/rw/reference/giganti_data.md)
  : Giganti Data Dataset generated using code from Giganti & Shepherd
  (2020)
- [`pool_rw()`](https://lucymcgowan.github.io/rw/reference/pool_rw.md) :
  Pool results with Robins-Wang variance
- [`with_rw()`](https://lucymcgowan.github.io/rw/reference/with_rw.md) :
  Fit analysis model with Robins-Wang variance calculation

